<!DOCTYPE html>
<html lang="ca">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historial jugador</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
  <style>
    .blackout {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
      z-index: 10000;
      background: #0000008c;
    }
    </style>
</head>

<body>
  <div class="container">
    <h1>Informaci√≥ jugador</h1>
    <div class="row">
      <div class="col-md-6">
        <h2>Jugador</h2>
        <select id="jugador" class="form-select seljugadors">
          <option disabled selected>Tria el jugador</option>
        
        </select>
      </div>
      <div class="col-md-6">
        <h2>Adversari</h2>
       
          <select id="adversari" class="form-select seljugadors">
          <option selected></option>
         
        </select>
     
      </div>


    </div>
  
  <br>
  <button onclick="canvia()" class="btn btn-primary">Cerca</button>
  <br><br>
  <ul id="resposta"  class="list-group  rounded-4"></ul>
  </div>
</div>
    <div class="blackout" id="spinner">
    <div class="d-flex justify-content-center pt-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>
  <script>
    const macroURL = "https://script.google.com/macros/s/AKfycbzI7IQHgb4g4T_7KVuTwW8Wm-nYFKnUz8VZTNKCo-iQW7-Hf2di1db1c3DE55Jar_WTVA/exec"
    var data = llistaJugadorsBarruf()
    function canvia(){
      spinner("")
    var jugador = document.getElementById("jugador").value;
    var adversari = document.getElementById("adversari").value;
    document.getElementById("resposta").innerHTML="" 
    
    iniciJSON(jugador,adversari)
    
  }
  
  function mostraOK(partides) {
    console.log(partides)
 var campionat    
    partides.forEach(partida=>{

if(partida.campionat!=campionat){
  campionat=partida.campionat
  const campionattemplate = `
<li class="list-group-item d-flex  align-items-center active">${partida.campionat}</li>
`
document.getElementById("resposta").innerHTML+=campionattemplate
}


const partidatemplate = `
<li class="list-group-item d-flex align-items-center">${partida.Jugador1} (${partida.Puntuacio_1}-${partida.Puntuacio_2}) ${partida.Jugador2}</li>
`
document.getElementById("resposta").innerHTML+=partidatemplate

    })
   spinner("d-none")  
  }



function llistaJugadorsBarruf(){
   // Crida a l'API del Google Apps Script
  var myHeaders = new Headers();
  var myInit = {
  method: "GET",
  headers: myHeaders,
  mode: "no-cors",
  cache: "default",
};
  Promise.all([    
    fetch(macroURL + "?page=jugadors"),
     
  ])
  .then(responses => Promise.all(responses.map(response => response.json())))
  .then(([data]) => {

      
       let jugadors = data.dades
    document.querySelectorAll(".seljugadors").forEach(sel=>{
for(index in jugadors) {
    sel.options[sel.options.length] = new Option(jugadors[index].Nom, jugadors[index].Nom);
}
    })
spinner("d-none")
  })
  .catch(error => console.error("Error:", error));
}    
function iniciJSON(jugador,adversari) { 

  // Crida a l'API del Google Apps Script
  var myHeaders = new Headers();
  var myInit = {
  method: "GET",
  headers: myHeaders,
  mode: "no-cors",
  cache: "default",
};
  var jugador=encodeURIComponent(jugador)
var adversari=encodeURIComponent(adversari)
  
  Promise.all([    
    fetch(macroURL + "?page=JSON&jugador="+jugador+"&adversari="+adversari),
     
  ])
  .then(responses => Promise.all(responses.map(response => response.json())))
  .then(([data]) => {
    // Process dataTrobades, dataJugadors, etc.
    // ...
       // Example: Accessing data from the 'trobades' response
       let partides = data.dades
      
       // Process 'trobades' data...
   
       // Example: Accessing data from the 'jugadors' response
       
   
       // Continue with your logic here..
  mostraOK(partides)
  })
  .catch(error => console.error("Error:", error));
}
    function spinner(estat){
  var spinner = document.getElementById("spinner")
  if(estat=="d-none"){
    spinner.classList.add("d-none")
  }else{
    spinner.classList.remove("d-none")
  }
}
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
  </script>
</body>

</html>
